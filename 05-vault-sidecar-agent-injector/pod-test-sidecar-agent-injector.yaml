---
apiVersion: v1
kind: Pod
metadata:
  name: test-sidecar-agent-injector
  annotations:
    # https://developer.hashicorp.com/vault/docs/platform/k8s/injector/annotations
    vault.hashicorp.com/agent-inject: 'true'
    vault.hashicorp.com/agent-inject-secret-foo.txt: '/secret/data/demo1'
    vault.hashicorp.com/agent-inject-secret-bar.txt: '/secret/data/demo2'
    vault.hashicorp.com/role: 'webapp'
    # Vault address to use (if different from the default configuration)
    vault.hashicorp.com/service: "http://hashicorp-vault-server.vault.svc.cluster.local:8200"
spec:
  securityContext:
    seccompProfile:
      type: RuntimeDefault
  containers:
    - name: test
      image: image-registry.openshift-image-registry.svc:5000/openshift/cli:latest
      command:
        - "/bin/bash"
        - "-c"
        - "while true; do cat /vault/secrets/; sleep 10; done"
      securityContext:
        allowPrivilegeEscalation: false
        runAsNonRoot: true
        capabilities:
          drop:
            - ALL
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
  serviceAccountName: default
